{"ast":null,"code":"import _objectSpread from\"/Users/heesoopark/Desktop/myprj/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Users/heesoopark/Desktop/myprj/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/heesoopark/Desktop/myprj/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/heesoopark/Desktop/myprj/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/heesoopark/Desktop/myprj/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import FormField from'../widgets/FormFields/formFields';import styles from'./dashboard.module.css';import{Editor}from'react-draft-wysiwyg';import{EditorState,convertFromRaw,convertToRaw}from'draft-js';import{stateToHTML}from'draft-js-export-html';import{firebase}from'../../firebase';import Uploader from'../widgets/FileUploader/fileUploader';var Dashboard=/*#__PURE__*/function(_Component){_inherits(Dashboard,_Component);var _super=_createSuper(Dashboard);function Dashboard(){var _this;_classCallCheck(this,Dashboard);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={editorState:EditorState.createEmpty(),registerError:'',loading:false,formdata:{author:{element:'input',value:'',config:{name:'author_input',type:'text',placeholder:'Enter your name'},validation:{required:true},valid:false,touched:false,validationMessage:''},title:{element:'input',value:'',config:{name:'title_input',type:'text',placeholder:'Enter your title'},validation:{required:true},valid:false,touched:false,validationMessage:''},body:{element:'texteditor',value:'',valid:true},image:{element:'image',value:'',valid:true}}};_this.updateForm=function(element){var content=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';var newFormdata=_objectSpread({},_this.state.formdata);var newElement=_objectSpread({},newFormdata[element.id]);if(content===''){newElement.value=element.event.target.value;}else{newElement.value=content;}if(element.blur){var validData=_this.validate(newElement);newElement.valid=validData[0];newElement.validationMessage=validData[1];}newElement.touched=element.blur;newFormdata[element.id]=newElement;_this.setState({formdata:newFormdata});};_this.validate=function(element){var error=[true,''];if(element.validation.required){var valid=element.value.trim()!=='';var message=\"\".concat(!valid?'This field is required':'');error=!valid?[valid,message]:error;}return error;};_this.submitForm=function(event){event.preventDefault();var dataToSubmit={};var formIsValid=true;for(var key in _this.state.formdata){dataToSubmit[key]=_this.state.formdata[key].value;}for(var _key2 in _this.state.formdata){formIsValid=_this.state.formdata[_key2].valid&&formIsValid;}if(formIsValid){_this.setState({loading:true,postError:''});firebase.firestore().collection('posts').add({author:dataToSubmit.author,title:dataToSubmit.title,body:dataToSubmit.body,image:dataToSubmit.image}).then(function(article){_this.props.history.push(\"/posts\");}).catch(function(e){_this.setState({postError:e.message});});console.log(\"SUCCESS\");}else{_this.setState({postError:'Something went wrong'});}};_this.submitButton=function(){return _this.state.loading?'loading...':/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"button\",{type:\"submit\"},\" Add post \"));};_this.showError=function(){return _this.state.registerError!==''?/*#__PURE__*/React.createElement(\"div\",{className:styles.error},_this.state.registerError):'';};_this.onEditorStateChange=function(editorState){var contentState=editorState.getCurrentContent();var rawState=convertToRaw(contentState);var html=stateToHTML(contentState);//console.log(this.state.updatedContent)\n_this.updateForm({id:'body'},html);_this.setState({editorState:editorState});};_this.storeFilename=function(filename){_this.updateForm({id:'image'},filename);};return _this;}_createClass(Dashboard,[{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/React.createElement(\"div\",{className:styles.postContainer},/*#__PURE__*/React.createElement(\"form\",{onSubmit:this.submitForm},/*#__PURE__*/React.createElement(\"h2\",null,\"Add Post\"),/*#__PURE__*/React.createElement(Uploader,{filename:function filename(_filename){return _this2.storeFilename(_filename);}}),/*#__PURE__*/React.createElement(FormField,{id:'author',formdata:this.state.formdata.author,change:function change(element){return _this2.updateForm(element);}}),/*#__PURE__*/React.createElement(FormField,{id:'title',formdata:this.state.formdata.title,change:function change(element){return _this2.updateForm(element);}}),/*#__PURE__*/React.createElement(Editor,{editorState:this.state.editorState,wrapperClassName:\"myEditor-wrapper\",editorClassName:\"myEditor-editor\",onEditorStateChange:this.onEditorStateChange}),this.submitButton(),this.showError()));}}]);return Dashboard;}(Component);export default Dashboard;","map":{"version":3,"sources":["/Users/heesoopark/Desktop/myprj/src/components/Dashboard/dashboard.js"],"names":["React","Component","FormField","styles","Editor","EditorState","convertFromRaw","convertToRaw","stateToHTML","firebase","Uploader","Dashboard","state","editorState","createEmpty","registerError","loading","formdata","author","element","value","config","name","type","placeholder","validation","required","valid","touched","validationMessage","title","body","image","updateForm","content","newFormdata","newElement","id","event","target","blur","validData","validate","setState","error","trim","message","submitForm","preventDefault","dataToSubmit","formIsValid","key","postError","firestore","collection","add","then","article","props","history","push","catch","e","console","log","submitButton","showError","onEditorStateChange","contentState","getCurrentContent","rawState","html","storeFilename","filename","postContainer"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport FormField from '../widgets/FormFields/formFields';\nimport styles from './dashboard.module.css';\n\nimport { Editor } from 'react-draft-wysiwyg';\nimport { EditorState, convertFromRaw, convertToRaw } from 'draft-js';\nimport { stateToHTML } from 'draft-js-export-html';\nimport { firebase } from '../../firebase';\n\nimport Uploader from '../widgets/FileUploader/fileUploader';\n\nclass Dashboard extends Component {\n    state = {\n        editorState: EditorState.createEmpty(),\n        registerError: '',\n        loading: false,\n        formdata:{\n            author:{\n                element:'input',\n                value:'',\n                config:{\n                    name:'author_input',\n                    type:'text',\n                    placeholder:'Enter your name'\n                },\n                validation:{\n                    required:true\n                },\n                valid:false,\n                touched:false,\n                validationMessage:''\n            },\n            title:{\n                element:'input',\n                value:'',\n                config:{\n                    name:'title_input',\n                    type:'text',\n                    placeholder:'Enter your title'\n                },\n                validation:{\n                    required:true\n                },\n                valid:false,\n                touched:false,\n                validationMessage:''\n            },\n            body:{\n                element: 'texteditor',\n                value:'',\n                valid:true\n            },\n            image:{\n                element: 'image',\n                value:'',\n                valid:true\n            }\n        }\n    }\n\n    updateForm = (element, content='') => {\n        const newFormdata = {\n            ...this.state.formdata\n        }\n        const newElement = {\n            ...newFormdata[element.id]\n        }\n\n        if(content === ''){\n            newElement.value = element.event.target.value;\n        }else{\n            newElement.value = content;\n        }\n\n        if(element.blur){\n            let validData = this.validate(newElement);\n            newElement.valid = validData[0];\n            newElement.validationMessage = validData[1];   \n        }\n        newElement.touched = element.blur;\n        newFormdata[element.id] = newElement;\n        \n        this.setState({\n            formdata:newFormdata\n        })\n    }\n\n    validate = (element) => {\n        let error = [true,''];\n\n        if(element.validation.required){\n            const valid = element.value.trim() !=='';\n            const message = `${!valid ? 'This field is required':''}`;\n            error = !valid ? [valid,message] : error\n        }\n\n        return error;\n    }\n\n    submitForm = (event) => {\n        event.preventDefault();\n\n        let dataToSubmit = {};\n        let formIsValid = true;\n\n        for(let key in this.state.formdata){\n            dataToSubmit[key] = this.state.formdata[key].value\n        }\n        for(let key in this.state.formdata){\n            formIsValid = this.state.formdata[key].valid && formIsValid;\n        }\n\n        if(formIsValid){\n            this.setState({\n                loading:true,\n                postError:''\n            })\n            firebase.firestore().collection('posts').add({\n                author: dataToSubmit.author,\n                title: dataToSubmit.title,\n                body: dataToSubmit.body,\n                image: dataToSubmit.image\n            }).then( article => {\n                this.props.history.push(`/posts`)\n            }).catch( e => {\n                this.setState({\n                    postError: e.message\n                })\n            }) \n            console.log(\"SUCCESS\")\n\n        }else{\n            this.setState({\n                postError: 'Something went wrong'\n            })\n        }\n    }\n\n    submitButton = () => (\n        this.state.loading ?\n            'loading...'\n        :\n        <div>\n            <button type=\"submit\"> Add post </button>\n        </div>\n    )\n\n    showError = () => (\n        this.state.registerError !== '' ? \n            <div className={styles.error}>{this.state.registerError}</div>\n        : ''\n    )\n\n    onEditorStateChange = (editorState) => {\n        let contentState = editorState.getCurrentContent();\n        let rawState = convertToRaw(contentState);\n        let html = stateToHTML(contentState)\n\n        //console.log(this.state.updatedContent)\n        this.updateForm({id:'body'}, html)\n\n        this.setState({\n            editorState\n        })\n    }\n\n    storeFilename = (filename) => {\n        this.updateForm({id:'image'}, filename)\n    }\n\n    render() {\n        return(\n            <div className={styles.postContainer}>\n                <form onSubmit={this.submitForm}>\n                    <h2>Add Post</h2>\n\n                    <Uploader\n                        filename={ (filename) => this.storeFilename(filename)}\n                    />\n\n                    <FormField\n                        id={'author'}\n                        formdata={this.state.formdata.author}\n                        change={(element)=>this.updateForm(element)}\n                    />\n                    <FormField\n                        id={'title'}\n                        formdata={this.state.formdata.title}\n                        change={(element)=>this.updateForm(element)}\n                    />\n\n                    <Editor\n                        editorState={this.state.editorState}\n                        wrapperClassName=\"myEditor-wrapper\"\n                        editorClassName=\"myEditor-editor\"\n                        onEditorStateChange={this.onEditorStateChange}\n                    />\n\n                    {this.submitButton()}\n                    {this.showError()}\n                </form>               \n            </div>\n        )\n    }\n}\n\nexport default Dashboard;"]},"metadata":{},"sourceType":"module"}